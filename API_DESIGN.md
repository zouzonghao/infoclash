# API è®¾è®¡æ–‡æ¡£

æœ¬æ–‡æ¡£å®šä¹‰äº† `infoclash` å‰ç«¯ä¸åç«¯äº¤äº’çš„ RESTful APIã€‚

## åŸºç¡€ URL

æ‰€æœ‰ API çš„åŸºç¡€è·¯å¾„ä¸º `/api`ã€‚

---

## 1. è¿æ¥è®°å½• (Connections)

### `GET /api/connections`

è·å–è¿æ¥çš„è¯¦ç»†è®°å½•ï¼Œæ”¯æŒç­›é€‰ã€æ’åºå’Œåˆ†é¡µã€‚

#### æŸ¥è¯¢å‚æ•° (Query Parameters)

| å‚æ•° | ç±»å‹ | å¯é€‰ | æè¿° | é»˜è®¤å€¼ | ç¤ºä¾‹ |
| :--- | :--- | :--- | :--- | :--- | :--- |
| `page` | `integer` | æ˜¯ | è¯·æ±‚çš„é¡µç ï¼Œä» 1 å¼€å§‹ã€‚ | `1` | `?page=2` |
| `pageSize` | `integer` | æ˜¯ | æ¯é¡µè¿”å›çš„è®°å½•æ•°ã€‚ | `20` | `?pageSize=50` |
| `host` | `string` | æ˜¯ | æŒ‰ä¸»æœºåè¿›è¡Œæ¨¡ç³Šæœç´¢ (`LIKE %host%`)ã€‚ | | `?host=cloudflare` |
| `sourceIP` | `string` | æ˜¯ | æŒ‰æº IP åœ°å€è¿›è¡Œæ¨¡ç³Šæœç´¢ (`LIKE %sourceIP%`)ã€‚ | | `?sourceIP=192.168` |
| `chain` | `string` | æ˜¯ | æŒ‰ä»£ç†é“¾åç§°è¿›è¡Œç²¾ç¡®åŒ¹é…ã€‚ | | `?chain=DIRECT` |
| `startDate` | `integer` | æ˜¯ | æŸ¥è¯¢çš„å¼€å§‹æ—¶é—´ (Unix æ—¶é—´æˆ³, ç§’)ã€‚ | | `?startDate=1672531200` |
| `endDate` | `integer` | æ˜¯ | æŸ¥è¯¢çš„ç»“æŸæ—¶é—´ (Unix æ—¶é—´æˆ³, ç§’)ã€‚ | | `?endDate=1675209600` |
| `sortBy` | `string` | æ˜¯ | æ’åºå­—æ®µã€‚å¯é€‰å€¼: `upload`, `download`, `start`, `metadata.host`, `metadata.sourceIP`ã€‚ | `start` | `?sortBy=download` |
| `sortOrder` | `string` | æ˜¯ | æ’åºé¡ºåºã€‚å¯é€‰å€¼: `asc`, `desc`ã€‚ | `desc` | `?sortOrder=asc` |

#### æˆåŠŸå“åº” (200 OK)

```json
{
  "total": 125,
  "page": 1,
  "pageSize": 20,
  "totalPages": 7,
  "data": [
    {
      "host": "speed.cloudflare.com",
      "sourceIP": "192.168.2.95",
      "upload": 10240,
      "download": 512000,
      "start": "2023-01-01T12:00:00Z",
      "chains": ["ğŸš€ èŠ‚ç‚¹é€‰æ‹©"]
    }
  ]
}
```

---

### `POST /api/connections/merge`

åˆå¹¶æŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„è¿æ¥è®°å½•ï¼Œå°†çŸ­æ—¶ã€é«˜é¢‘çš„è¿æ¥èšåˆæˆä¸€ä¸ªæ€»è®°å½•ï¼Œä»¥å‡å°‘æ•°æ®åº“ä¸­çš„æ•°æ®é‡ã€‚

#### è¯·æ±‚ä½“ (Request Body)

```json
{
  "startDate": 1672531200,
  "endDate": 1675209600,
  "interval": 5,
  "deleteSource": true
}
```

| å­—æ®µ | ç±»å‹ | å¿…é¡» | æè¿° |
| :--- | :--- | :--- | :--- |
| `startDate` | `integer` | æ˜¯ | åˆå¹¶èŒƒå›´çš„å¼€å§‹æ—¶é—´ (Unix æ—¶é—´æˆ³, ç§’)ã€‚ |
| `endDate` | `integer` | æ˜¯ | åˆå¹¶èŒƒå›´çš„ç»“æŸæ—¶é—´ (Unix æ—¶é—´æˆ³, ç§’)ã€‚ |
| `interval` | `integer` | æ˜¯ | åˆå¹¶çš„æ—¶é—´çª—å£å¤§å°ï¼Œå•ä½ä¸ºåˆ†é’Ÿã€‚ä¾‹å¦‚ï¼Œ`5` è¡¨ç¤ºå°†æ¯ 5 åˆ†é’Ÿå†…çš„ç›¸åŒä¸»æœºçš„è®°å½•åˆå¹¶ä¸ºä¸€æ¡ã€‚ |

#### æˆåŠŸå“åº” (200 OK)

```json
{
  "message": "åˆå¹¶æˆåŠŸ"
}
```

---

### `POST /api/connections/replace-host`

å°†å…·æœ‰ç‰¹å®šåŸŸååç¼€çš„ä¸»æœºåæ›¿æ¢ä¸ºå…¶æ ¹åŸŸåã€‚ä¾‹å¦‚ï¼Œå°† `v1.example.com` å’Œ `v2.example.com` éƒ½æ›¿æ¢ä¸º `example.com`ã€‚

#### è¯·æ±‚ä½“ (Request Body)

```json
{
  "domainSuffix": "example.com"
}
```

| å­—æ®µ | ç±»å‹ | å¿…é¡» | æè¿° |
| :--- | :--- | :--- | :--- |
| `domainSuffix` | `string` | æ˜¯ | è¦æ›¿æ¢çš„ç›®æ ‡åŸŸåã€‚æ‰€æœ‰ä»¥ `.` + `domainSuffix` ç»“å°¾æˆ–å®Œå…¨ç­‰äº `domainSuffix` çš„ä¸»æœºåéƒ½å°†è¢«æ›´æ–°ã€‚ |

#### æˆåŠŸå“åº” (200 OK)

```json
{
  "message": "æ›¿æ¢æˆåŠŸ",
  "rowsAffected": 15
}
```

---

## 2. æµé‡æ±‡æ€» (Summary)

### `GET /api/summary/traffic`

è·å–æŒ‰æ—¶é—´ç²’åº¦ï¼ˆå¤©æˆ–å°æ—¶ï¼‰åˆ†ç»„çš„æµé‡æ±‡æ€»æ•°æ®ï¼Œç”¨äºç»˜åˆ¶æ—¶é—´åºåˆ—å›¾è¡¨ã€‚

#### æŸ¥è¯¢å‚æ•° (Query Parameters)

| å‚æ•° | ç±»å‹ | å¯é€‰ | æè¿° | é»˜è®¤å€¼ | ç¤ºä¾‹ |
| :--- | :--- | :--- | :--- | :--- | :--- |
| `granularity` | `string` | æ˜¯ | æ—¶é—´ç²’åº¦ã€‚å¯é€‰å€¼: `day`, `hour`ã€‚ | `day` | `?granularity=hour` |
| `host` | `string` | æ˜¯ | æŒ‰ç‰¹å®šä¸»æœºåè¿›è¡Œç­›é€‰ã€‚ | | `?host=speed.cloudflare.com` |
| `startDate` | `integer` | æ˜¯ | æŸ¥è¯¢çš„å¼€å§‹æ—¶é—´ (Unix æ—¶é—´æˆ³, ç§’)ã€‚ | | `?startDate=1672531200` |
| `endDate` | `integer` | æ˜¯ | æŸ¥è¯¢çš„ç»“æŸæ—¶é—´ (Unix æ—¶é—´æˆ³, ç§’)ã€‚ | | `?endDate=1675209600` |

#### æˆåŠŸå“åº” (200 OK)

```json
[
  {
    "time": "2023-01-01 00:00:00",
    "upload": 1048576,
    "download": 20971520
  },
  {
    "time": "2023-01-02 00:00:00",
    "upload": 2097152,
    "download": 31457280
  }
]
```

---

### `GET /api/summary/hosts`

è·å–æŒ‰æ€»æµé‡ï¼ˆä¸Šä¼  + ä¸‹è½½ï¼‰æ’åºçš„ä¸»æœºæ’åã€‚

#### æŸ¥è¯¢å‚æ•° (Query Parameters)

| å‚æ•° | ç±»å‹ | å¯é€‰ | æè¿° | é»˜è®¤å€¼ | ç¤ºä¾‹ |
| :--- | :--- | :--- | :--- | :--- | :--- |
| `limit` | `integer` | æ˜¯ | è¿”å›çš„æ’åæ•°é‡ã€‚ | `10` | `?limit=20` |
| `startDate` | `integer` | æ˜¯ | æŸ¥è¯¢çš„å¼€å§‹æ—¶é—´ (Unix æ—¶é—´æˆ³, ç§’)ã€‚ | | `?startDate=1672531200` |
| `endDate` | `integer` | æ˜¯ | æŸ¥è¯¢çš„ç»“æŸæ—¶é—´ (Unix æ—¶é—´æˆ³, ç§’)ã€‚ | | `?endDate=1675209600` |

#### æˆåŠŸå“åº” (200 OK)

```json
[
  {
    "host": "speed.cloudflare.com",
    "upload": 1073741824,
    "download": 53687091200,
    "total": 54760833024
  },
  {
    "host": "api.google.com",
    "upload": 5242880,
    "download": 104857600,
    "total": 110100480
  }
]
```

---

## 3. è¾…åŠ©æ¥å£ (Helpers)

### `GET /api/hosts`

è·å–æ•°æ®åº“ä¸­æ‰€æœ‰ä¸é‡å¤çš„ä¸»æœºååˆ—è¡¨ï¼Œç”¨äºç­›é€‰å™¨ä¸‹æ‹‰èœå•ã€‚

#### æŸ¥è¯¢å‚æ•° (Query Parameters)

æ— ã€‚

#### æˆåŠŸå“åº” (200 OK)

```json
[
  "speed.cloudflare.com",
  "api.google.com",
  "v2ex.com"
]
```

---

### `GET /api/chains`

è·å–æ•°æ®åº“ä¸­æ‰€æœ‰ä¸é‡å¤çš„ä»£ç†é“¾åç§°åˆ—è¡¨ï¼Œç”¨äºç­›é€‰å™¨ä¸‹æ‹‰èœå•ã€‚

#### æŸ¥è¯¢å‚æ•° (Query Parameters)

æ— ã€‚

#### æˆåŠŸå“åº” (200 OK)

```json
[
  "DIRECT",
  "PROXY",
  "ğŸš€ èŠ‚ç‚¹é€‰æ‹©"
]